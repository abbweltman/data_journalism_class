library(dplyr)
library(tidyr)
library(janitor)
#install.packages("leaflet.extras")
library(leaflet.extras)
library(googlesheets4)
census_api_key("9cabe8a191a1f824755d4a1845f13cb08faa2c5f", install = TRUE, overwrite = TRUE)
smith <- read.csv("../data/smith1_balt.csv")
#199 census tracts
#25 zip codes (totalling 199 areas, but need to check boundaries)
x<- smith %>%
group_by(zip) %>%
count ()
sum(x$n)
#per capita income seems way too low
median(smith$income_per_capita, na.rm = TRUE) #22789.76
median(smith$pct_anymembershp_zip, na.rm = TRUE) #0.455563
summary(smith$pct_anymembershp_zip, na.rm = TRUE)
# Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's
#  0.3353  0.4444  0.4556  0.4613  0.4752  0.5241       3
median(smith$nbanks_zip, na.rm = TRUE) #5
summary(smith$nbanks_zip, na.rm = TRUE)
# Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's
# 0.000   2.000   5.000   5.847   8.000  14.000       3
median(smith$census_response_rate2020, na.rm = TRUE) #0.564
summary(smith$census_response_rate2020, na.rm = TRUE)
# Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's
#  0.2830  0.4753  0.5640  0.5594  0.6522  0.8360       3
#communities with greater than median membership - 46%- but less than median income - $22,790
himember <- smith %>%
group_by(neighborhood) %>%
select(pct_anymembershp_zip, income_per_capita, tract) %>%
arrange(desc(pct_anymembershp_zip)) %>%
filter(pct_anymembershp_zip >= 0.455563) %>%
filter(income_per_capita <= 22789.76) %>%
mutate(pct_anymembershp_zip = formattable::percent(pct_anymembershp_zip))
himember$income_per_capita <- formattable::currency(himember$income_per_capita, digits =0L)
library(kableExtra)
himember %>%
rename(Neighborhood = neighborhood, Membership = pct_anymembershp_zip, Per_Capita_Income = income_per_capita, Census_Tract = tract) %>%
kbl(caption = "Communities With Greater than Median Membership - 46%- but Less than Median Income - $22,790", font_size = 50, bold=T) %>%
kable_classic(full_width = T, html_font = "Cambria") %>%
column_spec(1, bold = T, border_right = T) %>%
column_spec(2, border_right = T, width = "10em", background = "yellow") %>%
column_spec(3, border_right = T, width = "10em") %>%
save_kable(file = "../DataOutput/himember.html", self_contained = T)
member_all <- smith %>%
group_by(neighborhood) %>%
select(pct_anymembershp_zip, income_per_capita, tract) %>%
arrange(desc(pct_anymembershp_zip)) %>%
mutate(pct_anymembershp_zip = formattable::percent(pct_anymembershp_zip))
member_all$income_per_capita <- formattable::currency(member_all$income_per_capita, digits =0L)
library(kableExtra)
member_all %>%
rename(Neighborhood = neighborhood, Membership = pct_anymembershp_zip, Per_Capita_Income = income_per_capita, Census_Tract = tract) %>%
kbl(caption = "All Communities By Civic Membership", font_size = 50, bold=T) %>%
kable_classic(full_width = T, html_font = "Cambria") %>%
column_spec(1, bold = T, border_right = T) %>%
column_spec(2, border_right = T, width = "10em", background = "yellow") %>%
column_spec(3, border_right = T, width = "10em") %>%
save_kable(file = "../DataOutput/member_all.html", self_contained = T)
#subset the geometry
md_income2020_geo <- get_acs(geography = "tract",
variables = c(number_households = "B19001_001", median_income = "B19013_001"),
state = "MD",
year = 2020, geometry = TRUE) %>%
mutate(year=("2020")) %>%
select(GEOID, NAME)
member_all <- member_all %>%
mutate(GEOID = as.character(tract))
#join geocoordinates with baltcity
member_all2 <- md_income2020_geo  %>%
right_join(member_all, by=c("GEOID")) %>%
distinct()
member_all2$pct_anymembershp_zip <- formattable::percent(member_all2$pct_anymembershp_zip, 1)
member_all2$income_per_capita <-
paste0('$', round(member_all2$income_per_capita,0))
View(member_all2)
#Map by Median Income Difference
member_all2 <- member_all2 %>%
sf::st_transform('+proj=longlat +datum=WGS84')
pal <- colorNumeric(
palette = "inferno",
domain = member_all2$pct_anymembershp_zip
)
#https://leaflet-extras.github.io/leaflet-providers/preview/
leafMap <- leaflet() %>%
addProviderTiles(providers$Esri.WorldStreetMap) %>%
addPolygons(data = member_all,
color = ~pal(pct_anymembershp_zip),
weight = 2.5,
smoothFactor = 0.2,
fillOpacity = 0.5,
label = paste("Pct membership in civic groups is:",(himember2$pct_anymembershp_zip), "and income is",(himember2$income_per_capita), "in", (himember2$neighborhood))) %>%
addLegend(
position = "bottomright",
pal = pal,
values = himember2$pct_anymembershp_zip,
title = "Pct Membership <br> 2020"
)
#Map by Median Income Difference
member_all2 <- member_all2 %>%
sf::st_transform('+proj=longlat +datum=WGS84')
pal <- colorNumeric(
palette = "inferno",
domain = member_all2$pct_anymembershp_zip
)
#https://leaflet-extras.github.io/leaflet-providers/preview/
leafMap <- leaflet() %>%
addProviderTiles(providers$Esri.WorldStreetMap) %>%
addPolygons(data = member_all,
color = ~pal(pct_anymembershp_zip),
weight = 2.5,
smoothFactor = 0.2,
fillOpacity = 0.5,
label = paste("Pct membership in civic groups is:",(member_all2$pct_anymembershp_zip), "and income is",(member_all2$income_per_capita), "in", (member_all2$neighborhood))) %>%
addLegend(
position = "bottomright",
pal = pal,
values = member_all2$pct_anymembershp_zip,
title = "Pct Membership <br> 2020"
)
#Map by Median Income Difference
member_all2 <- member_all2 %>%
sf::st_transform('+proj=longlat +datum=WGS84')
pal <- colorNumeric(
palette = "inferno",
domain = member_all2$pct_anymembershp_zip
)
#https://leaflet-extras.github.io/leaflet-providers/preview/
leafMap <- leaflet() %>%
addProviderTiles(providers$Esri.WorldStreetMap) %>%
addPolygons(data = member_all2,
color = ~pal(pct_anymembershp_zip),
weight = 2.5,
smoothFactor = 0.2,
fillOpacity = 0.5,
label = paste("Pct membership in civic groups is:",(member_all2$pct_anymembershp_zip), "and income is",(member_all2$income_per_capita), "in", (member_all2$neighborhood))) %>%
addLegend(
position = "bottomright",
pal = pal,
values = member_all2$pct_anymembershp_zip,
title = "Pct Membership <br> 2020"
)
saveWidget(leafMap, "../member_all_map_jan_24.html")
leafMap
View(member_all2)
md_income2020_geo <- get_acs(geography = "tract",
variables = c(number_households = "B19001_001", median_income = "B19013_001"),
state = "MD",
year = 2020, geometry = TRUE) %>%
mutate(year=("2020")) %>%
select(GEOID, NAME)
member_all <- member_all %>%
mutate(GEOID = as.character(tract))
#join geocoordinates with baltcity
member_all2 <- md_income2020_geo  %>%
right_join(member_all, by=c("GEOID")) %>%
distinct()
member_all2$pct_anymembershp_zip <- formattable::percent(member_all2$pct_anymembershp_zip, 1)
View(member_all2)
leafMap <- leaflet() %>%
addProviderTiles(providers$Esri.WorldStreetMap) %>%
addPolygons(data = member_all2,
color = ~pal(pct_anymembershp_zip),
weight = 2.5,
smoothFactor = 0.2,
fillOpacity = 0.5,
label = paste("Pct membership in civic groups is:",(member_all2$pct_anymembershp_zip), "and income is",(member_all2$income_per_capita), "in", (member_all2$neighborhood))) %>%
addLegend(
position = "bottomright",
pal = pal,
values = member_all2$pct_anymembershp_zip,
title = "Pct Membership <br> 2020"
) %>%
addControl(
html = "<div style='background-color: white; padding: 10px; border-radius: 5px;'><h4>Membership Percentage by Neighborhood</h4></div>",
position = "topright"
)
leafMap
leafMap <- leaflet() %>%
addProviderTiles(providers$Esri.WorldStreetMap) %>%
addPolygons(data = member_all2,
color = ~pal(pct_anymembershp_zip),
weight = 2.5,
smoothFactor = 0.2,
fillOpacity = 0.5,
label = paste("Pct membership in civic groups is:",(member_all2$pct_anymembershp_zip), "and income is",(member_all2$income_per_capita), "in", (member_all2$neighborhood))) %>%
addLegend(
position = "bottomright",
pal = pal,
values = member_all2$pct_anymembershp_zip,
title = "Pct Membership <br> 2020"
) %>%
addControl(
html = "<div style='background-color: white; padding: 5px; border-radius: 3px;'><h2>Membership Percentage by Neighborhood</h2></div>",
position = "topright"
)
leafMap
leafMap <- leaflet() %>%
addProviderTiles(providers$Esri.WorldStreetMap) %>%
addPolygons(data = member_all2,
color = ~pal(pct_anymembershp_zip),
weight = 2.5,
smoothFactor = 0.2,
fillOpacity = 0.5,
label = paste("Pct membership in civic groups is:",(member_all2$pct_anymembershp_zip), "and income is",(member_all2$income_per_capita), "in", (member_all2$neighborhood))) %>%
addLegend(
position = "bottomright",
pal = pal,
values = member_all2$pct_anymembershp_zip,
title = "Pct Membership <br> 2020"
) %>%
addControl(
html = "<div style='background-color: white; padding: 5px; border-radius: 3px;'><h3>Civil Membership & Income in Baltimore</h3></div>",
position = "topright"
)
member_all2 <- member_all2 %>%
sf::st_transform('+proj=longlat +datum=WGS84')
pal <- colorNumeric(
palette = "inferno",
domain = member_all2$pct_anymembershp_zip
)
#https://leaflet-extras.github.io/leaflet-providers/preview/
leafMap <- leaflet() %>%
addProviderTiles(providers$Esri.WorldStreetMap) %>%
addPolygons(data = member_all2,
color = ~pal(pct_anymembershp_zip),
weight = 2.5,
smoothFactor = 0.2,
fillOpacity = 0.5,
label = paste("Pct membership in civic groups is:",(member_all2$pct_anymembershp_zip), "and income is",(member_all2$income_per_capita), "in", (member_all2$neighborhood))) %>%
addLegend(
position = "bottomright",
pal = pal,
values = member_all2$pct_anymembershp_zip,
title = "Pct Membership <br> 2020"
) %>%
addControl(
html = "<div style='background-color: white; padding: 5px; border-radius: 3px;'><h3>Civil Membership & Income in Baltimore</h3></div>",
position = "topright"
)
leafMap
#Map by Median Income Difference
member_all2 <- member_all2 %>%
sf::st_transform('+proj=longlat +datum=WGS84')
pal <- colorNumeric(
palette = "inferno",
domain = member_all2$pct_anymembershp_zip
)
#https://leaflet-extras.github.io/leaflet-providers/preview/
leafMap <- leaflet() %>%
addProviderTiles(providers$Esri.WorldStreetMap) %>%
addPolygons(data = member_all2,
color = ~pal(pct_anymembershp_zip),
weight = 2.5,
smoothFactor = 0.2,
fillOpacity = 0.5,
label = paste("Pct membership in civic groups is:",(member_all2$pct_anymembershp_zip), "and income is",(member_all2$income_per_capita), "in", (member_all2$neighborhood))) %>%
addLegend(
position = "bottomright",
pal = pal,
values = member_all2$pct_anymembershp_zip,
title = "Pct Membership <br> 2020"
) %>%
addControl(
html = "<div style='background-color: white; padding: 5px; border-radius: 3px;'><h3>Civil Membership & Income in Baltimore</h3></div>",
position = "topright"
)
saveWidget(leafMap, "../member_all_map_jan_24.html")
leafMap
member_all <- smith %>%
group_by(neighborhood) %>%
select(pct_anymembershp_zip, income_per_capita, tract) %>%
arrange(desc(pct_anymembershp_zip)) %>%
mutate(pct_anymembershp_zip = formattable::percent(pct_anymembershp_zip))
member_all$income_per_capita <- formattable::currency(member_all$income_per_capita, digits =0L)
library(kableExtra)
member_all %>%
rename(Neighborhood = neighborhood, Membership = pct_anymembershp_zip, Per_Capita_Income = income_per_capita, Census_Tract = tract) %>%
kbl(caption = "All Communities By Civic Membership", font_size = 50, bold=T) %>%
kable_classic(full_width = T, html_font = "Cambria") %>%
column_spec(1, bold = T, border_right = T) %>%
column_spec(2, border_right = T, width = "10em", background = "yellow") %>%
column_spec(3, border_right = T, width = "10em") %>%
save_kable(file = "../output/member_all.html", self_contained = T)
#Map by Median Income Difference
member_all2 <- member_all2 %>%
sf::st_transform('+proj=longlat +datum=WGS84')
pal <- colorNumeric(
palette = "inferno",
domain = member_all2$pct_anymembershp_zip
)
#https://leaflet-extras.github.io/leaflet-providers/preview/
leafMap <- leaflet() %>%
addProviderTiles(providers$Esri.WorldStreetMap) %>%
addPolygons(data = member_all2,
color = ~pal(pct_anymembershp_zip),
weight = 2.5,
smoothFactor = 0.2,
fillOpacity = 0.5,
label = paste("Pct membership in civic groups is:",(member_all2$pct_anymembershp_zip), "and income is",(member_all2$income_per_capita), "in", (member_all2$neighborhood))) %>%
# addLegend(
#   position = "bottomright",
#   pal = pal,
#   values = member_all2$pct_anymembershp_zip,
#   title = "Pct Membership <br> 2020"
# ) %>%
addControl(
html = '<div id="legend" style="background-color: white; padding: 10px; border-radius: 5px; border: 1px solid #ccc; text-align: center;">
<p><strong>Pct Membership 2020</strong></p>
<div style="background-color: #fee08b; height: 20px; width: 30px; display: inline-block;"></div> 0-20%
<br>
<div style="background-color: #d73027; height: 20px; width: 30px; display: inline-block;"></div> 20-40%
<br>
<div style="background-color: #4575b4; height: 20px; width: 30px; display: inline-block;"></div> 40-60%
<br>
<div style="background-color: #313695; height: 20px; width: 30px; display: inline-block;"></div> 60-80%
<br>
<div style="background-color: #313695; height: 20px; width: 30px; display: inline-block;"></div> 80-100%
</div>',
position = "bottomright"
) %>%
addControl(
html = "<div style='background-color: white; padding: 5px; border-radius: 3px;'><h3>Civil Membership & Income in Baltimore</h3></div>",
position = "topright"
)
#saveWidget(leafMap, "../member_all_map_jan_24.html")
leafMap
View(member_all2)
#Map by Median Income Difference
member_all2 <- member_all2 %>%
sf::st_transform('+proj=longlat +datum=WGS84')
pal <- colorNumeric(
palette = "inferno",
domain = member_all2$pct_anymembershp_zip
)
#https://leaflet-extras.github.io/leaflet-providers/preview/
leafMap <- leaflet() %>%
addProviderTiles(providers$Esri.WorldStreetMap) %>%
addPolygons(data = member_all2,
color = ~pal(pct_anymembershp_zip),
weight = 2.5,
smoothFactor = 0.2,
fillOpacity = 0.5,
label = paste("Pct membership in civic groups is:",(member_all2$pct_anymembershp_zip), "and income is",(member_all2$income_per_capita), "in", (member_all2$neighborhood))) %>%
# addLegend(
#   position = "bottomright",
#   pal = pal,
#   values = member_all2$pct_anymembershp_zip,
#   title = "Pct Membership <br> 2020"
# ) %>%
addControl(
html = '<div id="legend" style="background-color: white; padding: 10px; border-radius: 5px; border: 1px solid #ccc; text-align: center;">
<p><strong>Pct Membership 2020</strong></p>
<div style="background-color: #4575b4; height: 20px; width: 30px; display: inline-block;"></div> 30-40%
<br>
<div style="background-color: #313695; height: 20px; width: 30px; display: inline-block;"></div> 40-50%
<br>
<div style="background-color: #4575b4; height: 20px; width: 30px; display: inline-block;"></div> 50-60%
<br>
<div style="background-color: #fee08b; height: 20px; width: 30px; display: inline-block;"></div> 60-70%
</div>',
position = "bottomright"
) %>%
addControl(
html = "<div style='background-color: white; padding: 5px; border-radius: 3px;'><h3>Civil Membership & Income in Baltimore</h3></div>",
position = "topright"
)
#saveWidget(leafMap, "../member_all_map_jan_24.html")
leafMap
#Map by Median Income Difference
member_all2 <- member_all2 %>%
sf::st_transform('+proj=longlat +datum=WGS84')
pal <- colorNumeric(
palette = "inferno",
domain = member_all2$pct_anymembershp_zip
)
#https://leaflet-extras.github.io/leaflet-providers/preview/
leafMap <- leaflet() %>%
addProviderTiles(providers$Esri.WorldStreetMap) %>%
addPolygons(data = member_all2,
color = ~pal(pct_anymembershp_zip),
weight = 2.5,
smoothFactor = 0.2,
fillOpacity = 0.5,
label = paste("Pct membership in civic groups is:",(member_all2$pct_anymembershp_zip), "and income is",(member_all2$income_per_capita), "in", (member_all2$neighborhood))) %>%
# addLegend(
#   position = "bottomright",
#   pal = pal,
#   values = member_all2$pct_anymembershp_zip,
#   title = "Pct Membership <br> 2020"
# ) %>%
addControl(
html = '<div id="legend" style="background-color: white; padding: 10px; border-radius: 5px; border: 1px solid #ccc; text-align: center;">
<p><strong>Pct Membership 2020</strong></p>
<div style="background-color: black; height: 20px; width: 30px; display: inline-block;"></div> 30-39%
<br>
<div style="background-color: #e41a1c; height: 20px; width: 30px; display: inline-block;"></div> 40-45%
<br>
<div style="background-color: #fc7f5e; height: 20px; width: 30px; display: inline-block;"></div> 46-50%
<br>
<div style="background-color: #ffffbf; height: 20px; width: 30px; display: inline-block;"></div> 51-60%
</div>',
position = "bottomright"
) %>%
addControl(
html = "<div style='background-color: white; padding: 5px; border-radius: 3px;'><h3>Civil Membership & Income in Baltimore</h3></div>",
position = "topright"
)
#saveWidget(leafMap, "../member_all_map_jan_24.html")
leafMap
#Map by Median Income Difference
member_all2 <- member_all2 %>%
sf::st_transform('+proj=longlat +datum=WGS84')
pal <- colorNumeric(
palette = "inferno",
domain = member_all2$pct_anymembershp_zip
)
#https://leaflet-extras.github.io/leaflet-providers/preview/
leafMap <- leaflet() %>%
addProviderTiles(providers$Esri.WorldStreetMap) %>%
addPolygons(data = member_all2,
color = ~pal(pct_anymembershp_zip),
weight = 2.5,
smoothFactor = 0.2,
fillOpacity = 0.5,
label = paste("Pct membership in civic groups is:",(member_all2$pct_anymembershp_zip), "and income is",(member_all2$income_per_capita), "in", (member_all2$neighborhood))) %>%
# addLegend(
#   position = "bottomright",
#   pal = pal,
#   values = member_all2$pct_anymembershp_zip,
#   title = "Pct Membership <br> 2020"
# ) %>%
addControl(
html = '<div id="legend" style="background-color: white; padding: 10px; border-radius: 5px; border: 1px solid #ccc; text-align: center;">
<p><strong>Pct Membership 2020</strong></p>
<div style="background-color: black; height: 20px; width: 30px; display: inline-block;"></div> 30-39%
<br>
<div style="background-color: #e41a1c; height: 20px; width: 30px; display: inline-block;"></div> 40-45%
<br>
<div style="background-color: #fa8072; height: 20px; width: 30px; display: inline-block;"></div> 46-50%
<br>
<div style="background-color: #ffffbf; height: 20px; width: 30px; display: inline-block;"></div> 51-60%
</div>',
position = "bottomright"
) %>%
addControl(
html = "<div style='background-color: white; padding: 5px; border-radius: 3px;'><h3>Civil Membership & Income in Baltimore</h3></div>",
position = "topright"
)
#saveWidget(leafMap, "../member_all_map_jan_24.html")
leafMap
#subset the geometry
md_income2020_geo <- get_acs(geography = "tract",
variables = c(number_households = "B19001_001", median_income = "B19013_001"),
state = "MD",
year = 2020, geometry = TRUE) %>%
mutate(year=("2020")) %>%
select(GEOID, NAME)
member_all <- member_all %>%
mutate(GEOID = as.character(tract))
#join geocoordinates with baltcity
member_all2 <- md_income2020_geo  %>%
right_join(member_all, by=c("GEOID")) %>%
distinct()
member_all2$pct_anymembershp_zip <- formattable::percent(member_all2$pct_anymembershp_zip, 1)
# member_all2$income_per_capita <-
#   paste0('$', round(member_all2$income_per_capita,0))
#Map by Median Income Difference
member_all2 <- member_all2 %>%
sf::st_transform('+proj=longlat +datum=WGS84')
pal <- colorNumeric(
palette = "inferno",
domain = member_all2$pct_anymembershp_zip
)
#https://leaflet-extras.github.io/leaflet-providers/preview/
leafMap <- leaflet() %>%
addProviderTiles(providers$Esri.WorldStreetMap) %>%
addPolygons(data = member_all2,
color = ~pal(pct_anymembershp_zip),
weight = 2.5,
smoothFactor = 0.2,
fillOpacity = 0.5,
label = paste("Pct membership in civic groups is:",(member_all2$pct_anymembershp_zip), "and income is",(member_all2$income_per_capita), "in", (member_all2$neighborhood))) %>%
# addLegend(
#   position = "bottomright",
#   pal = pal,
#   values = member_all2$pct_anymembershp_zip,
#   title = "Pct Membership <br> 2020"
# ) %>%
addControl(
html = '<div id="legend" style="background-color: white; padding: 10px; border-radius: 5px; border: 1px solid #ccc; text-align: center;">
<p><strong>Pct Membership 2020</strong></p>
<div style="background-color: black; height: 20px; width: 30px; display: inline-block;"></div> 30-39%
<br>
<div style="background-color: #e75480; height: 20px; width: 30px; display: inline-block;"></div> 40-45%
<br>
<div style="background-color: #fa8072; height: 20px; width: 30px; display: inline-block;"></div> 46-50%
<br>
<div style="background-color: #ffffbf; height: 20px; width: 30px; display: inline-block;"></div> 51-60%
</div>',
position = "bottomright"
) %>%
addControl(
html = "<div style='background-color: white; padding: 5px; border-radius: 3px;'><h3>Civil Membership & Income in Baltimore</h3></div>",
position = "topright"
)
#saveWidget(leafMap, "../member_all_map_jan_24.html")
leafMap
saveWidget(leafMap, "../member_all_map_jan_24.html")
saveWidget(leafMap, "../output/member_all_map_jan_24.html")
